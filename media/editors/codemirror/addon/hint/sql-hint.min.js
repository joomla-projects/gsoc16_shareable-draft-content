!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],a):a(CodeMirror)}(function(a){"use strict";function b(a){return"[object Array]"==Object.prototype.toString.call(a)}function c(b){var c=b.doc.modeOption;return"sql"===c&&(c="text/x-sql"),a.resolveMode(c).keywords}function d(a){return"string"==typeof a?a:a.text}function e(a,c){return b(c)&&(c={columns:c}),c.text||(c.text=a),c}function f(a){var c={};if(b(a))for(var f=a.length-1;f>=0;f--){var g=a[f];c[d(g).toUpperCase()]=e(d(g),g)}else if(a)for(var h in a)c[h.toUpperCase()]=e(h,a[h]);return c}function g(a){return r[a.toUpperCase()]}function h(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function i(a,b){var c=a.length,e=d(b).substr(0,c);return a.toUpperCase()===e.toUpperCase()}function j(a,c,d,e){if(b(d))for(var f=0;f<d.length;f++)i(c,d[f])&&a.push(e(d[f]));else for(var g in d)if(d.hasOwnProperty(g)){var h=d[g];h=h&&h!==!0?h.displayText?{text:h.text,displayText:h.displayText}:h.text:g,i(c,h)&&a.push(e(h))}}function k(a){return"."==a.charAt(0)&&(a=a.substr(1)),a.replace(/`/g,"")}function l(a){for(var b=d(a).split("."),c=0;c<b.length;c++)b[c]="`"+b[c]+"`";var e=b.join(".");return"string"==typeof a?e:(a=h(a),a.text=e,a)}function m(a,b,c,d){for(var e=!1,f=[],i=b.start,m=!0;m;)m="."==b.string.charAt(0),e=e||"`"==b.string.charAt(0),i=b.start,f.unshift(k(b.string)),b=d.getTokenAt(v(a.line,b.start)),"."==b.string&&(m=!0,b=d.getTokenAt(v(a.line,b.start)));var n=f.join(".");j(c,n,r,function(a){return e?l(a):a}),j(c,n,s,function(a){return e?l(a):a}),n=f.pop();var o=f.join("."),p=!1,t=o;if(!g(o)){var u=o;o=q(o,d),o!==u&&(p=!0)}var w=g(o);return w&&w.columns&&(w=w.columns),w&&j(c,n,w,function(a){var b=o;return 1==p&&(b=t),"string"==typeof a?a=b+"."+a:(a=h(a),a.text=b+"."+a.text),e?l(a):a}),i}function n(a,b){if(a)for(var c=/[,;]/g,d=a.split(" "),e=0;e<d.length;e++)b(d[e]?d[e].replace(c,""):"")}function o(a){return a.line+a.ch/Math.pow(10,6)}function p(a){return v(Math.floor(a),+a.toString().split(".").pop())}function q(a,b){for(var c=b.doc,d=c.getValue(),e=a.toUpperCase(),f="",h="",i=[],j={start:v(0,0),end:v(b.lastLine(),b.getLineHandle(b.lastLine()).length)},k=d.indexOf(u.QUERY_DIV);-1!=k;)i.push(c.posFromIndex(k)),k=d.indexOf(u.QUERY_DIV,k+1);i.unshift(v(0,0)),i.push(v(b.lastLine(),b.getLineHandle(b.lastLine()).text.length));for(var l=0,m=o(b.getCursor()),q=0;q<i.length;q++){var r=o(i[q]);if(m>l&&r>=m){j={start:p(l),end:p(r)};break}l=r}for(var s=c.getRange(j.start,j.end,!1),q=0;q<s.length;q++){var t=s[q];if(n(t,function(a){var b=a.toUpperCase();b===e&&g(f)&&(h=f),b!==u.ALIAS_KEYWORD&&(f=a)}),h)break}return h}var r,s,t,u={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},v=a.Pos;a.registerHelper("hint","sql",function(a,b){r=f(b&&b.tables);var d=b&&b.defaultTable,e=b&&b.disableKeywords;s=d&&g(d),t=c(a),d&&!s&&(s=q(d,a)),s=s||[],s.columns&&(s=s.columns);var h,i,k,l=a.getCursor(),n=[],o=a.getTokenAt(l);return o.end>l.ch&&(o.end=l.ch,o.string=o.string.slice(0,l.ch-o.start)),o.string.match(/^[.`\w@]\w*$/)?(k=o.string,h=o.start,i=o.end):(h=i=l.ch,k=""),"."==k.charAt(0)||"`"==k.charAt(0)?h=m(l,o,n,a):(j(n,k,r,function(a){return a}),j(n,k,s,function(a){return a}),e||j(n,k,t,function(a){return a.toUpperCase()})),{list:n,from:v(l.line,h),to:v(l.line,i)}})});